(function(c){c.fn.msword_html_filter=function(a){function b(a){var b=a.html();b=b.replace(/\x3c!--[\s\S]+?--\x3e/gi,"");b=b.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,"");b=b.replace(/<(\/?)s>/gi,"<$1strike>");b=b.replace(/&nbsp;/gi," ");b=b.replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(a,c){return 0<c.length?c.replace(/./," ").slice(Math.floor(c.length/2)).split("").join("\u00a0"):
""});a.html(b);c("p",a).each(function(){var a=c(this).attr("style");(a=/mso-list:\w+ \w+([0-9]+)/.exec(a))&&c(this).data("_listLevel",parseInt(a[1],10))});var d=0,g=null;c("p",a).each(function(){var a=c(this).data("_listLevel");if(void 0!=a){var b=c(this).text(),e="<ul></ul>";/^\s*\w+\./.test(b)&&((b=/([0-9])\./.exec(b))?(b=parseInt(b[1],10),e=1<b?'<ol start="'+b+'"></ol>':"<ol></ol>"):e="<ol></ol>");a>d&&(0==d?(c(this).before(e),g=c(this).prev()):g=c(e).appendTo(g));if(a<d)for(b=0;b<d-a;b++)g=g.parent();
c("span:first",this).remove();g.append("<li>"+c(this).html()+"</li>");c(this).remove();d=a}else d=0});c("[style]",a).removeAttr("style");c("[align]",a).removeAttr("align");c("span",a).replaceWith(function(){return c(this).contents()});c("span:empty",a).remove();c("[class^='Mso']",a).removeAttr("class");c("p:empty",a).remove()}c.extend({},a);return this.each(function(){c(this).on("keyup",function(){c("#src").text(c("#editor").html());var a=c(this).html();/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(a)&&
b(c(this))})})}})(jQuery);
function tsxEdClass(){this.eid=0;this.param={};this.textarea={};this.font_array={arial:"Arial, Helvetica, sans-serif",georgia:"Georgia, serif",tahoma:"Tahoma, Geneva, sans-serif",times:"'Times New Roman', Times, serif",verdana:"Verdana, Geneva, sans-serif"};var c=this;this.init=function(a){document.execCommand("defaultParagraphSeparator",!1,"p");if(a&&a.targ&&$(a.targ).length){c.eid="tsx"+c.uid();c.textarea[c.eid]=a.targ;var b=$(a.targ).val();b=b?b:"";var d="";if(a&&a.tools){var e=a.tools.split(","),
f;for(f in e)c.tools[e[f]].button&&(d+=c.tools[e[f]].button({id:c.eid}))}d=d?'<div data-id="'+c.eid+'" class="tce_tools_c">'+d+"</div>":"";$(a.targ).before('<div id="'+c.eid+'" class="tce_content_c">'+d+'<div contenteditable="true" class="tce_content">'+b+"</div></div>").hide();$("#"+c.eid).on("paste",function(a){var b=$(a.target).parents(".tce_content_c").attr("id");c.pasteFormat({e:a,id:b})});$("#"+c.eid).on("keyup",function(a){var b=$(a.target).parents(".tce_content_c").attr("id");c.keyUp({e:a,
id:b})});$("#"+c.eid).on("mousedown",".tce_tools_c",function(a){a=$(this).attr("data-id");$("#"+a+" .tce_content").focus()});$("#"+c.eid+" .tce_content").on("click","img,p,h1,h2,h3,h4,li,ul,ol,td,th,table,blockquote,a,b,strong,i,em,u,s,strike,span",function(a){a.stopPropagation();c.editElm({e:a,t:this})});$("#"+c.eid).on("mousedown",".tce_tools_btn,.tce_tools_numric_up,.tce_tools_numric_dw",function(a){a=$(this).parents(".tce_content_c").attr("id");c.saveRange({id:a})});$("#"+c.eid).on("click",".tce_tools_btn",
function(a){var b=$(this).parents(".tce_content_c").attr("id");if(b){$("#"+b+" .tce_content").focus();c.restoreRange({id:b});a.stopPropagation();$(this).parent().find(".tce_tools_btn_active").removeClass("tce_tools_btn_active");a=$(this).attr("data-action");var d=$(this).attr("data-val");a&&c.tools[a].apply&&c.tools[a].apply({val:d,id:b});$(this).addClass("tce_tools_btn_active")}});document.addEventListener("keydown",c.keyCode);return c.eid}};this.tools={format:{button:function(a){return c.getOption({name:"format",
id:a.id,options:[{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 1",val:"h1",css:"h1"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 2",val:"h2",css:"h2"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 3",val:"h3",css:"h3"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 4",val:"h4",css:"h4"},{name:"\u041f\u0430\u0440\u0430\u0433\u0440\u0430\u0444",val:"p",selected:!0,css:"p"},{name:"\u0426\u0438\u0442\u0430\u0442\u0430",val:"blockquote",
css:"blockquote"}]})},apply:function(a){var b=a.id;!b||"undefined"==typeof c.param[b]||"h1"!=c.param[b].conttagname&&"h2"!=c.param[b].conttagname&&"h3"!=c.param[b].conttagname&&"h4"!=c.param[b].conttagname&&"p"!=c.param[b].conttagname&&"blockquote"!=c.param[b].conttagname||($(c.param[b].cont).replaceWith(function(b,c){return $("<"+a.val+' id="tce-replacer">').html(c)}),c.detectEl({id:"#"+b+" #tce-replacer"}),$("#"+b+" #tce-replacer").removeAttr("id"))},sel:function(a){var b=a.id;a&&b&&a.tn&&$("#"+
b+" .tce_tools_select_format .tce_tools_select_option."+a.tn).length&&($("#"+b+" .tce_tools_select_format .tce_tools_selected").removeClass("tce_tools_selected"),$("#"+b+" .tce_tools_select_format .tce_tools_select_option."+a.tn).addClass("tce_tools_selected"))}},align:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_align_c"><span data-action="align" data-val="left" title="\u041f\u043e \u043b\u0435\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e" class="tce_tools_btn tce_align-left"></span><span data-action="align" data-val="center" title="\u041f\u043e \u0446\u0435\u043d\u0442\u0440\u0443" class="tce_tools_btn tce_align-center"></span><span data-action="align" data-val="right" title="\u041f\u043e \u043f\u0440\u0430\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e" class="tce_tools_btn tce_align-right"></span><span data-action="align" data-val="justify" title="\u041f\u043e \u0448\u0438\u0440\u0438\u043d\u0435" class="tce_tools_btn tce_align-justify"></span></span>'},
apply:function(a){var b=a.id;b&&"undefined"!=typeof c.param[b]&&("h1"==c.param[b].conttagname||"h2"==c.param[b].conttagname||"h3"==c.param[b].conttagname||"h4"==c.param[b].conttagname||"p"==c.param[b].conttagname||"blockquote"==c.param[b].conttagname)&&a.val&&($(c.param[b].cont).css("text-align",a.val),$("#"+b+" .tce_btn_align_c .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active"),$("#"+b+" .tce_tools_btn.tce_align-"+a.val).addClass("tce_tools_btn_active"))},sel:function(a){var b=
a.id;a&&b&&a.tn&&(a=$(c.param[b].cont).css("text-align"),a="start"==a?"left":a,$("#"+b+" .tce_btn_align_c .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active"),$("#"+b+" .tce_tools_btn.tce_align-"+a).addClass("tce_tools_btn_active"))}},mark:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_mark_c"><span data-action="mark" data-val="bold" title="\u0416\u0438\u0440\u043d\u044b\u0439" class="tce_tools_btn tce_mark-b"></span><span data-action="mark" data-val="italic" title="\u041a\u0443\u0440\u0441\u0438\u0432" class="tce_tools_btn tce_mark-i"></span><span data-action="mark" data-val="underline" title="\u041f\u043e\u0434\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439" class="tce_tools_btn tce_mark-u"></span><span data-action="mark" data-val="strikethrough" title="\u041f\u0435\u0440\u0435\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439" class="tce_tools_btn tce_mark-s"></span></span>'},
apply:function(a){var b=a.id;if(b&&"undefined"!=typeof c.param[b]){var d=window.getSelection();if("undefind"!=typeof d&&d.isCollapsed){if($(c.param[b].el).parents(".tce_content").length&&("b"==c.param[b].tagname||"strong"==c.param[b].tagname||"i"==c.param[b].tagname||"em"==c.param[b].tagname||"u"==c.param[b].tagname||"s"==c.param[b].tagname||"strike"==c.param[b].tagname||"span"==c.param[b].tagname)){var e="";"bold"==a.val?e="strong":"italic"==a.val?e="em":"underline"==a.val?e="u":"strikethrough"==
a.val&&(e="strike");$(c.param[b].el).replaceWith(function(a,b){return $("<"+e+' id="tce-replacer">').html(b)});c.detectEl({id:"#"+b+" #tce-replacer"});$("#"+b+" #tce-replacer").removeAttr("id")}}else 0<d.rangeCount&&(b=d.getRangeAt(0),$(b.commonAncestorContainer).parents(".tce_content").length&&document.execCommand(a.val))}},sel:function(a){var b=a.id;a&&b&&a.tn&&("span"==a.tn?"line-through"==$(c.param[b].el).css("text-decoration-line")?$("#"+b+" .tce_tools_btn.tce_mark-s").addClass("tce_tools_btn_active"):
"underline"==$(c.param[b].el).css("text-decoration-line")&&$("#"+b+" .tce_tools_btn.tce_mark-u").addClass("tce_tools_btn_active"):(a="strong"==a.tn?"b":"em"==a.tn?"i":"strike"==a.tn?"s":a.tn,$("#"+b+" .tce_tools_btn.tce_mark-"+a).addClass("tce_tools_btn_active")))}},font:{button:function(a){return c.getOption({name:"font",id:a.id,options:[{name:"Arial",selected:!0,val:"arial",css:"arial"},{name:"Georgia",val:"georgia",css:"georgia"},{name:"Tahoma",val:"tahoma",css:"tahoma"},{name:"Times New",val:"times",
css:"times"},{name:"Verdana",val:"verdana",css:"verdana"}]})},apply:function(a){var b=a.id;b&&"undefined"!=typeof c.param[b]&&("h1"==c.param[b].conttagname||"h2"==c.param[b].conttagname||"h3"==c.param[b].conttagname||"h4"==c.param[b].conttagname||"p"==c.param[b].conttagname||"blockquote"==c.param[b].conttagname)&&c.font_array[a.val]&&$(c.param[b].cont).css("font-family",c.font_array[a.val])},sel:function(a){var b=a.id;a&&b&&a.tn&&(font=$(c.param[b].cont).css("font-family").split(" "),font=font[0].replace(",",
"").replace("'","").replace('"',"").toLowerCase(),$("#"+b+" .tce_tools_select_font .tce_tools_selected").removeClass("tce_tools_selected"),$("#"+b+" .tce_tools_select_font .tce_tools_select_option."+font).addClass("tce_tools_selected"))}},fontsize:{button:function(a){return'<span class="tce_tools_numric_c tce_btn_fontsize_c"><span data-min="9" data-max="46" class="tce_tools_numric_tx">14</span><span onClick="tsxEd.numberPlus({t:this,action:\'fontsize\',id:\''+a.id+"'});\" class=\"tce_tools_numric_up\"></span><span onClick=\"tsxEd.numberPlus({t:this,s:1,action:'fontsize',id:'"+
a.id+'\'});" class="tce_tools_numric_dw"></span></span>'},apply:function(a){var b=a.id;if(b&&"undefined"!=typeof c.param[b]){var d=window.getSelection();if(d.isCollapsed){if("span"==c.param[b].tagname)return $(c.param[b].el).css("font-size",a.val+"px"),!0;if("h1"==c.param[b].conttagname||"h2"==c.param[b].conttagname||"h3"==c.param[b].conttagname||"h4"==c.param[b].conttagname||"p"==c.param[b].conttagname||"blockquote"==c.param[b].conttagname)return $(c.param[b].cont).css("font-size",a.val+"px"),!0}else if(0<
d.rangeCount&&(d=d.getRangeAt(0),$(d.commonAncestorContainer).parents(".tce_content").length))return a=$("<span/>",{text:document.getSelection()}).css("font-size",a.val+"px").attr("id","tce-replacer").prop("outerHTML"),document.execCommand("insertHTML",!1,a),c.detectEl({id:"#"+b+" #tce-replacer"}),$("#"+b+" #tce-replacer").removeAttr("id"),!0}},sel:function(a){var b=a.id;if("span"==a.etn)var d=$(c.param[b].el).css("font-size");else if("h1"==a.tn||"h2"==a.tn||"h3"==a.tn||"h4"==a.tn||"p"==a.tn||"blockquote"==
a.tn)d=$(c.param[b].cont).css("font-size");d&&(a=parseInt(d))&&$("#"+b+" .tce_btn_fontsize_c .tce_tools_numric_tx").text(a)}},blank:{button:function(a){},apply:function(a){},sel:function(a){}}};this.saveArea=function(a){if(a&&a.id){var b=$("#"+a.id+" .tce_content");if(b.length&&(b=b.html(),$(c.textarea[a.id]).val(b),"function"==typeof a.callback&&a.callback({id:a.id,ta:c.textarea[a.id]}),a["return"]))return b}};this.numberPlus=function(a){if(a&&a.t){c.restoreRange({id:a.id});var b=$(a.t).parent().find(".tce_tools_numric_tx"),
d=b.attr("data-min")?parseInt(b.attr("data-min")):0,e=b.attr("data-max")?parseInt(b.attr("data-max")):0,f=b.text();f=f?parseInt(f):d;d=a.s?f-1>=d?f-1:f:f+1<=e?f+1:f;f!=d&&a.action&&c.tools[a.action].apply&&c.tools[a.action].apply({val:d,id:a.id})&&b.text(d)}};this.editElm=function(a){if(a=c.detectEl({t:a.t})){$("#"+a+" .tce_btn_mark_c .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active");if("h1"==c.param[a].conttagname||"h2"==c.param[a].conttagname||"h3"==c.param[a].conttagname||
"h4"==c.param[a].conttagname||"p"==c.param[a].conttagname||"blockquote"==c.param[a].conttagname)c.tools.format.sel({tn:c.param[a].conttagname,id:a}),c.tools.font.sel({tn:c.param[a].conttagname,id:a}),c.tools.fontsize.sel({tn:c.param[a].conttagname,etn:c.param[a].tagname,id:a}),c.tools.align.sel({tn:c.param[a].conttagname,id:a});"b"!=c.param[a].tagname&&"strong"!=c.param[a].tagname&&"i"!=c.param[a].tagname&&"em"!=c.param[a].tagname&&"u"!=c.param[a].tagname&&"s"!=c.param[a].tagname&&"strike"!=c.param[a].tagname&&
"span"!=c.param[a].tagname||c.tools.mark.sel({tn:c.param[a].tagname,id:a})}};this.detectEl=function(a){var b=!1;a&&a.t?b=$(a.t):a&&a.id&&(b=$(a.id));if(0!=b&&(a=b.parents(".tce_content_c").attr("id"))){var d=b.get(0).tagName.toLowerCase(),e=b,f=d;if("p"!=d||"ul"!=d||"ol"!=d){var g=b.parents("p:first");g.length&&(e=g,f=g.get(0).tagName.toLowerCase())}c.param[a]={};c.param[a].tagname=d;c.param[a].conttagname=f;c.param[a].cont=e;c.param[a].el=b;return a}};this.getOption=function(a){var b="";if(a&&a.options&&
a.name){b+='<span onClick="$(this).addClass(\'tce_tools_select_activate\');" class="tce_tools_select_c tce_tools_select_'+a.name+'"><span class="tce_tools_select">';for(var c in a.options)a.options[c].val&&(b+='<span onClick="tsxEd.getOptionVal(this);" data-id="'+a.id+'" data-name="'+a.name+'" data-value="'+a.options[c].val+'" class="tce_tools_select_option'+(a.options[c].selected?" tce_tools_selected":"")+(a.options[c].css?" "+a.options[c].css:"")+'">'+a.options[c].name+"</span>");b+="</span></span>"}return b};
this.getOptionVal=function(a){if(a&&$(a).parents(".tce_tools_select_activate").length){var b=$(a).attr("data-value");b=b?b:"";var d=$(a).attr("data-name"),e=$(a).attr("data-id");d&&c.tools[d].apply&&(c.tools[d].apply({val:b,t:a,id:e}),$(a).parent().find(".tce_tools_selected").removeClass("tce_tools_selected"),$(a).addClass("tce_tools_selected"),setTimeout(function(){$(a).parents(".tce_tools_select_activate").removeClass("tce_tools_select_activate")},.1))}};this.keyUp=function(a){a.e&&8==a.e.keyCode&&
(a=a.id,$("#"+a+" .tce_content p, #"+a+" .tce_content div, #"+a+" .tce_content h1, #"+a+" .tce_content h2, #"+a+" .tce_content h3, #"+a+" .tce_content h4, #"+a+" .tce_content blockquote, #"+a+" .tce_content ul, #"+a+" .tce_content ol").length||(document.execCommand("insertHTML",!1,'<p id="tce-replacer"></p>'),c.detectEl({id:"#"+a+" #tce-replacer"}),$("#"+a+" #tce-replacer").removeAttr("id")))};this.pasteFormat=function(a){a.id&&$("#"+a.id+" .tce_content").msword_html_filter()};this.uid=function(){return"_"+
Math.random().toString(36).substr(2,9)};this.saveRange=function(a){if(a&&a.id&&"undefined"!=typeof c.param[a.id]){c.param[a.id].range=null;var b=window.getSelection();0<b.rangeCount&&(c.param[a.id].range=b.getRangeAt(0))}};this.restoreRange=function(a){a&&a.id&&"undefined"!=typeof c.param[a.id]&&(a=c.param[a.id].range)&&window.getSelection&&(s=window.getSelection(),0<s.rangeCount&&s.removeAllRanges(),s.addRange(a))}}var tsxEd=new tsxEdClass;