/* TCE EDIT Open Source  |  https://github.com/tsenix/tce_edit  |   https://tsenix.com  */
function tsxEdClass(){this.eid=0;this.custom_style=[{n:"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u0441 \u0440\u0430\u043c\u043a\u0430\u043c\u0438",v:"price"}];this.param={};this.activelink=!1;this.textarea={};this.font_array={arial:"Arial, Helvetica, sans-serif",georgia:"Georgia, serif",tahoma:"Tahoma, Geneva, sans-serif",times:"'Times New Roman', Times, serif",verdana:"Verdana, Geneva, sans-serif"};var b=this;this.init=function(a){document.execCommand("defaultParagraphSeparator",!1,"p");if(a&&
a.targ&&$(a.targ).length){b.eid="tsx"+b.uid();b.textarea[b.eid]=a.targ;var c=$(a.targ).val();""==c.trim()&&(c="<p></p>");c=c?c.replace(RegExp('src="edit/uploads',"gm"),'src="/edit/uploads'):"";var d="";if(a&&a.tools){var e=a.tools.split(",");for(g in e)"undefined"!=typeof b.tools[e[g]]&&"undefined"!=typeof b.tools[e[g]].button&&(d+=b.tools[e[g]].button({id:b.eid}))}if(a&&a.styles){e=a.styles.split(",");for(var f in e)if(e[f]){var g=e[f].split(";");g[1]?b.custom_style.push({n:g[0],v:g[1]}):b.custom_style.push({n:g[0],
v:g[0]})}}a&&1==a.activelink&&(b.activelink=!0);d=d?'<div data-id="'+b.eid+'" class="tce_tools_c">'+d+"</div>":"";f=a&&1==a.disable?"":' contenteditable="true"';e='<div style="display:none;" ondragenter="return false;" ondragleave="return false;" ondragover="return false;" ondrop="return false;" id="sc_code_editor_'+b.eid+'" class="sc_code_editor_c" contenteditable="true">'+b.htmlspecialchars(c)+"</div>";$(a.targ).before('<div id="'+b.eid+'" class="tce_content_c">'+d+'<div class="tce_content_x sc_editor_container"><div'+
f+' class="tce_content">'+c+'</div><div class="clear"></div>'+e+"</div></div>").hide();c=document.createElement("p");d=$("#"+b.eid+" .tce_content").get(0);(f=d.firstChild)&&"#text"==f.nodeName&&(c.appendChild(f),d.prepend(c));document.getElementById(b.eid).addEventListener("paste",function(a){if($(a.target).parents(".tce_content").length){a.preventDefault();var c="";textarr=a.clipboardData.getData("text/plain").trim().split("\n");if(textarr.length)for(a=0;a<textarr.length;a++)textarr[a].trim()&&(c+=
"<p>"+textarr[a].trim()+"</p>");c&&document.execCommand("insertHTML",!1,c)}else if($(a.target).hasClass("sc_code_editor_c")||$(a.target).parents(".sc_code_editor_c").length)c=$(a.target).parents(".tce_content_c").attr("id"),b.pasteCodeFormat({e:a,id:c})});$("#sc_code_editor_"+b.eid).on("keydown",function(a){$(a.target).parents(".tce_content_c").attr("id");if($(a.target).hasClass("sc_code_editor_c")){if(13==a.keyCode)return a.preventDefault(),document.execCommand("insertHTML",!1,"\n"),a.stopPropagation(),
!1;if(9==a.keyCode)return document.execCommand("insertHTML",!1,"\t"),!1}});$("#"+b.eid).on("keyup",function(a){var c=$(a.target).parents(".tce_content_c").attr("id");b.keyUp({e:a,id:c})});$("#"+b.eid).on("keydown",function(a){var c=$(a.target).parents(".tce_content_c").attr("id");if(13==a.keyCode&&$(b.param[c].cont)&&"div"==$(b.param[c].cont).get(0).tagName.toLowerCase())return $(b.param[c].cont).after('<p id="tce-replacer"></p>'),b.detectEl({id:"#"+c+" #tce-replacer"}),rng=document.createRange(),
rng.selectNodeContents(document.getElementById("tce-replacer")),rng.collapse(!1),sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(rng),$("#"+c+" #tce-replacer").removeAttr("id"),a.stopPropagation(),!1});$("#"+b.eid+" .tce_content").on("click","img,p,h1,h2,h3,h4,li,ul,ol,td,th,table,blockquote,a,b,strong,i,em,u,s,strike,span,div",function(c){c.stopPropagation();1!=a.disable&&b.editElm({e:c,t:this})});$("#"+b.eid).on("mousedown",".tce_tools_btn",function(a){a=$(this).parents(".tce_content_c").attr("id");
b.saveRange({id:a})});$("#"+b.eid).on("click",".tce_tools_btn",function(c){var d=$(this).parents(".tce_content_c").attr("id");if(d&&1!=a.disable){b.restoreRange({id:d});c.stopPropagation();$(this).parent().find(".tce_tools_btn_active").removeClass("tce_tools_btn_active");c=$(this).attr("data-action");var e=$(this).attr("data-val");c&&b.tools[c].apply&&b.tools[c].apply({val:e,id:d,t:$(this)});$(this).addClass("tce_tools_btn_active")}});return b.eid}};this.tools={format:{button:function(a){return b.getOption({name:"format",
id:a.id,options:[{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 1",val:"h1",css:"h1"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 2",val:"h2",css:"h2"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 3",val:"h3",css:"h3"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 4",val:"h4",css:"h4"},{name:"\u041f\u0430\u0440\u0430\u0433\u0440\u0430\u0444",val:"p",selected:!0,css:"p"},{name:"\u0426\u0438\u0442\u0430\u0442\u0430",val:"blockquote",
css:"blockquote"}]})},apply:function(a){var c=a.id;!c||"undefined"==typeof b.param[c]||"h1"!=b.param[c].conttagname&&"h2"!=b.param[c].conttagname&&"h3"!=b.param[c].conttagname&&"h4"!=b.param[c].conttagname&&"p"!=b.param[c].conttagname&&"blockquote"!=b.param[c].conttagname||($(b.param[c].cont).replaceWith(function(c,b){return $("<"+a.val+' id="tce-replacer">').html(b)}),b.detectEl({id:"#"+c+" #tce-replacer"}),$("#"+c+" #tce-replacer").removeAttr("id"))},sel:function(a){var c=a.id;a&&c&&a.tn&&$("#"+
c+" .tce_tools_select_format .tce_tools_select_option."+a.tn).length&&($("#"+c+" .tce_tools_select_format .tce_tools_selected").removeClass("tce_tools_selected"),$("#"+c+" .tce_tools_select_format .tce_tools_select_option."+a.tn).addClass("tce_tools_selected"))}},align:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_align_c"><span data-action="align" data-val="left" title="\u041f\u043e \u043b\u0435\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e" class="tce_tools_btn tce_align-left"></span><span data-action="align" data-val="center" title="\u041f\u043e \u0446\u0435\u043d\u0442\u0440\u0443" class="tce_tools_btn tce_align-center"></span><span data-action="align" data-val="right" title="\u041f\u043e \u043f\u0440\u0430\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e" class="tce_tools_btn tce_align-right"></span><span data-action="align" data-val="justify" title="\u041f\u043e \u0448\u0438\u0440\u0438\u043d\u0435" class="tce_tools_btn tce_align-justify"></span></span>'},
apply:function(a){var c=a.id;c&&"undefined"!=typeof b.param[c]&&("h1"==b.param[c].conttagname||"h2"==b.param[c].conttagname||"h3"==b.param[c].conttagname||"h4"==b.param[c].conttagname||"p"==b.param[c].conttagname||"blockquote"==b.param[c].conttagname)&&a.val&&($(b.param[c].cont).css("text-align",a.val),$("#"+c+" .tce_btn_align_c .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active"),$("#"+c+" .tce_tools_btn.tce_align-"+a.val).addClass("tce_tools_btn_active"))},sel:function(a){var c=
a.id;a&&c&&a.tn&&(a=$(b.param[c].cont).css("text-align"),a="start"==a?"left":a,$("#"+c+" .tce_btn_align_c .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active"),$("#"+c+" .tce_tools_btn.tce_align-"+a).addClass("tce_tools_btn_active"))}},mark:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_mark_c"><span data-action="mark" data-val="bold" title="\u0416\u0438\u0440\u043d\u044b\u0439" class="tce_tools_btn tce_mark-b"></span><span data-action="mark" data-val="italic" title="\u041a\u0443\u0440\u0441\u0438\u0432" class="tce_tools_btn tce_mark-i"></span><span data-action="mark" data-val="underline" title="\u041f\u043e\u0434\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439" class="tce_tools_btn tce_mark-u"></span><span data-action="mark" data-val="strikethrough" title="\u041f\u0435\u0440\u0435\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439" class="tce_tools_btn tce_mark-s"></span></span>'},
apply:function(a){var c=a.id;if(c&&"undefined"!=typeof b.param[c]){var d=window.getSelection();if("undefind"!=typeof d&&d.isCollapsed){if($(b.param[c].el).parents(".tce_content").length&&("b"==b.param[c].tagname||"strong"==b.param[c].tagname||"i"==b.param[c].tagname||"em"==b.param[c].tagname||"u"==b.param[c].tagname||"s"==b.param[c].tagname||"strike"==b.param[c].tagname||"span"==b.param[c].tagname)){var e="";"bold"==a.val?e="strong":"italic"==a.val?e="em":"underline"==a.val?e="u":"strikethrough"==
a.val&&(e="strike");$(b.param[c].el).replaceWith(function(a,c){return $("<"+e+' id="tce-replacer">').html(c)});b.detectEl({id:"#"+c+" #tce-replacer"});$("#"+c+" #tce-replacer").removeAttr("id")}}else 0<d.rangeCount&&(c=d.getRangeAt(0),$(c.commonAncestorContainer).parents(".tce_content").length&&document.execCommand(a.val))}},sel:function(a){var c=a.id;a&&c&&a.tn&&("span"==a.tn?"line-through"==$(b.param[c].el).css("text-decoration-line")?$("#"+c+" .tce_tools_btn.tce_mark-s").addClass("tce_tools_btn_active"):
"underline"==$(b.param[c].el).css("text-decoration-line")&&$("#"+c+" .tce_tools_btn.tce_mark-u").addClass("tce_tools_btn_active"):(a="strong"==a.tn?"b":"em"==a.tn?"i":"strike"==a.tn?"s":a.tn,$("#"+c+" .tce_tools_btn.tce_mark-"+a).addClass("tce_tools_btn_active")))}},font:{button:function(a){return b.getOption({name:"font",id:a.id,options:[{name:"Arial",selected:!0,val:"arial",css:"arial"},{name:"Georgia",val:"georgia",css:"georgia"},{name:"Tahoma",val:"tahoma",css:"tahoma"},{name:"Times New",val:"times",
css:"times"},{name:"Verdana",val:"verdana",css:"verdana"}]})},apply:function(a){var c=a.id;c&&"undefined"!=typeof b.param[c]&&("h1"==b.param[c].conttagname||"h2"==b.param[c].conttagname||"h3"==b.param[c].conttagname||"h4"==b.param[c].conttagname||"p"==b.param[c].conttagname||"blockquote"==b.param[c].conttagname)&&b.font_array[a.val]&&$(b.param[c].cont).css("font-family",b.font_array[a.val])},sel:function(a){var c=a.id;a&&c&&a.tn&&(font=$(b.param[c].cont).css("font-family").split(" "),font=font[0].replace(",",
"").replace("'","").replace('"',"").toLowerCase(),$("#"+c+" .tce_tools_select_font .tce_tools_selected").removeClass("tce_tools_selected"),$("#"+c+" .tce_tools_select_font .tce_tools_select_option."+font).addClass("tce_tools_selected"))}},fontsize:{button:function(a){return'<span class="tce_tools_numric_c tce_btn_fontsize_c"><span data-min="9" data-max="46" class="tce_tools_numric_tx">14</span><span onClick="tsxEd.numberPlus({t:this,action:\'fontsize\',id:\''+a.id+"'});\" class=\"tce_tools_numric_up\"></span><span onClick=\"tsxEd.numberPlus({t:this,s:1,action:'fontsize',id:'"+
a.id+'\'});" class="tce_tools_numric_dw"></span></span>'},apply:function(a){var c=a.id;if(c&&"undefined"!=typeof b.param[c]){var d=window.getSelection();if(d.isCollapsed){if("span"==b.param[c].tagname)return $(b.param[c].el).css("font-size",a.val+"px"),!0;if("h1"==b.param[c].conttagname||"h2"==b.param[c].conttagname||"h3"==b.param[c].conttagname||"h4"==b.param[c].conttagname||"p"==b.param[c].conttagname||"blockquote"==b.param[c].conttagname)return $(b.param[c].cont).css("font-size",a.val+"px"),!0}else if(0<
d.rangeCount&&(d=d.getRangeAt(0),$(d.commonAncestorContainer).parents(".tce_content").length))return a=$("<span/>",{text:document.getSelection()}).css("font-size",a.val+"px").attr("id","tce-replacer").prop("outerHTML"),document.execCommand("insertHTML",!1,a),b.detectEl({id:"#"+c+" #tce-replacer"}),$("#"+c+" #tce-replacer").removeAttr("id"),!0}},sel:function(a){var c=a.id;if("span"==a.etn)var d=$(b.param[c].el).css("font-size");else if("h1"==a.tn||"h2"==a.tn||"h3"==a.tn||"h4"==a.tn||"p"==a.tn||"blockquote"==
a.tn)d=$(b.param[c].cont).css("font-size");d&&(a=parseInt(d))&&$("#"+c+" .tce_btn_fontsize_c .tce_tools_numric_tx").text(a)}},paint:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_paint_c"><span data-action="paint" data-val="foreColor" title="\u0426\u0432\u0435\u0442 \u0442\u0435\u043a\u0441\u0442\u0430" class="tce_tools_btn tce_paint-tc"></span><span data-action="paint" data-val="backColor" title="\u0426\u0432\u0435\u0442 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430" class="tce_tools_btn tce_paint-tm"></span><span data-action="paint" data-val="link" title="\u0421\u0441\u044b\u043b\u043a\u0430" class="tce_tools_btn tce_paint-link"></span></span>'},
apply:function(a){var c=window.getSelection();if("addlink"==a.action){var d=$("#"+a.id+" .tce_tools_pop_c input[name=src]").val();if(0==d.length)return $("#"+a.id+" .tce_tools_pop_c input[name=src]").addClass("error").focus(),!1;$("#"+a.id+" .tce_tools_pop_c input[name=src]").removeClass("error");c=$("#"+a.id+" .tce_tools_pop_c input[name=text]").val();if(0==c.length)return $("#"+a.id+" .tce_tools_pop_c input[name=text]").addClass("error").focus(),!1;$("#"+a.id+" .tce_tools_pop_c input[name=text]").removeClass("error");
var e=$("#"+a.id+" .tce_tools_pop_c input[name=title]").val(),f=$("#"+a.id+" .sc_frame_form_xcheckbox").hasClass("checked");"a"==b.param[a.id].tagname?($(b.param[a.id].el).attr("href",d).text(c),e&&$(b.param[a.id].el).attr("title",e),f&&$(b.param[a.id].el).attr("target","_blank")):(b.restoreRange({id:a.id}),document.execCommand("insertHTML",!1,"<a"+(f?' target="_blank"':"")+' href="'+d+'">'+c+"</a>"));b.closePop({id:a.id})}else if(0<c.rangeCount||"a"==a.tn)"backColor"==a.val||"foreColor"==a.val?$(a.t).attr("data-color")?
("null"!=$(a.t).attr("data-color")?document.execCommand(a.val,!1,$(a.t).attr("data-color")):document.execCommand("removeFormat",!1,a.val),$("#"+a.id+" .tce_tools_popbg_c, #"+a.id+" .tce_dp_tools_c").remove()):b.addDpTool({id:a.id,tool:"paint",val:a.val,pos:a.t.position(),width:"114px",height:"85px"}):"link"==a.val&&(d="",c=c?c:"",f=e="","a"==b.param[a.id].tagname&&(d=$(b.param[a.id].el).attr("href"),c=$(b.param[a.id].el).text(),e=(e=$(b.param[a.id].el).attr("title"))?e:"",f="_blank"==$(b.param[a.id].el).attr("target")?
" checked":""),b.addPop({id:a.id,title:"\u0421\u0441\u044b\u043b\u043a\u0430",content:'<div class="tce_tools_pop_form_c"><div class="tce_tools_pop_form_i"><label>\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044b\u043b\u043a\u0438</label><input value="'+d+'" placeholder="https://" name="src" type="text" /></div><div class="tce_tools_pop_form_i"><label>\u0422\u0435\u043a\u0441\u0442 \u0441\u0441\u044b\u043b\u043a\u0438</label><input value="'+c+'" name="text" value="'+b.param[a.id].range+'" type="text" /></div><div class="tce_tools_pop_form_i"><label>\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a</label><input value="'+
e+'" name="title" type="text" /></div><div class="tce_tools_pop_form_i"><label></label><span onclick="$(this).children().toggleClass(\'checked\');" class="sc_frame_form_xlable"><span name="blank" data-value="1" class="sc_frame_form_checkbox sc_frame_form_xcheckbox'+f+'"></span> \u041e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0432 \u043d\u043e\u0432\u043e\u043c \u043e\u043a\u043d\u0435</span></div></div>',button:[{title:"OK",tools:"paint",action:"addlink",active:1},{title:"\u041e\u0442\u043c\u0435\u043d\u0430",
action:"close"}]}))},dptool:function(a){for(var c=a&&"backColor"==a.val?"#ffcdd2 #ffb74d #ffd54f #fff176 #aed581 #a5d6a7 #80cbc4 #81d4fa #9fa8da #b39ddb #ce93d8 null".split(" "):"#f44336 #ff9800 #ffc107 #ffeb3b #8bc34a #4caf50 #009688 #03a9f4 #3f51b5 #673ab7 #9c27b0 null".split(" "),b='<span class="tce_tools_btn_c tce_btn_paint_c">',e=0;e<c.length;e++)b+='<span data-action="paint" data-val="'+a.val+'" data-color="'+c[e]+'" style="background:'+c[e]+';" class="tce_tools_btn"></span>';return b+"</span>"},
sel:function(a){var c=a.id;a&&c&&a.tn&&"a"==a.tn&&$("#"+c+" .tce_paint-link").addClass("tce_tools_btn_active")}},files:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_file_c"><span data-action="files" title="\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f" class="tce_tools_btn tce_img-add"></span><span data-action="files" data-val="file" title="\u0424\u0430\u0439\u043b\u044b" class="tce_tools_btn tce_file-add"></span></span>'},apply:function(a){scHp.filesOpen(a.id,
"file"==a.val?"txt,pdf,doc,docx,xls,xlsx":!1)},add:function(a){if(a.id&&1==a.file)"undefined"!=typeof b.param[a.id]&&"undefined"!=typeof b.param[a.id].cont?(b.restoreRange({id:a.id}),document.execCommand("insertHTML",!1,a.list)):$("#"+a.id+" .tce_content").append("<p>"+a.list+"</p>");else if(a.id&&a.imgs.length){for(var c="",d=0;d<a.imgs.length;d++)if(a.imgs[d])if(a.zoom){var e=a.imgs[d].split("/");e[e.length-1]=".thumb_"+e[e.length-1];imgi=e.join("/");c+='<img class="lifs_photo" src="'+imgi+'"/>'}else c+=
a.block?'<p class="nui_images_container"><img src="'+a.imgs[d]+'"/></p>':'<img src="'+a.imgs[d]+'"/>';a.zoom&&(c='<p class="nui_images_container">'+c+"</p>");"undefined"!=typeof b.param[a.id]?b.param[a.id].cont?a.zoom||a.block?$(b.param[a.id].cont).after(c):(b.restoreRange({id:a.id}),document.execCommand("insertHTML",!1,c)):$("#"+a.id+" .tce_content").append(c):$("#"+a.id+" .tce_content").append(c)}},sel:function(a){$("#"+a.id+" .tce_img-add").addClass("tce_tools_btn_active")}},img:{sel:function(a){$("#"+
a.id+" .sc_visual_active").removeClass("sc_visual_active");$(b.param[a.id].el).addClass("sc_visual_active");b.addMinipan({id:a.id},[{tool:"img",action:"nofloat",css:"tce_img-nofloat",title:"\u0411\u0435\u0437 \u043e\u0431\u0442\u0435\u043a\u0430\u043d\u0438\u044f"},{tool:"img",action:"floatleft",css:"tce_img-floatleft",title:"\u041e\u0431\u0442\u0435\u043a\u0430\u043d\u0438\u0435 \u043f\u043e \u043b\u0435\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e"},{tool:"img",action:"floatright",css:"tce_img-floatright",
title:"\u041e\u0431\u0442\u0435\u043a\u0430\u043d\u0438\u0435 \u043f\u043e \u043f\u0440\u0430\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e"}])},nofloat:function(a){$(b.param[a.id].el).removeClass("lfs-fl-left lfs-fl-right").click()},floatleft:function(a){$(b.param[a.id].el).removeClass("lfs-fl-left lfs-fl-right").addClass("lfs-fl-left").click()},floatright:function(a){$(b.param[a.id].el).removeClass("lfs-fl-left lfs-fl-right").addClass("lfs-fl-right").click()},param:function(a){}},list:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_list_c"><span data-action="list" title="\u0421\u043f\u0438\u0441\u043e\u043a" class="tce_tools_btn tce_list-ul"></span><span data-action="list" data-val="ol" title="\u041d\u0443\u043c\u0435\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a" class="tce_tools_btn tce_list-ol"></span></span>'},
apply:function(a){b.restoreRange({id:a.id});document.execCommand("ol"==a.val?"insertorderedlist":"insertUnorderedList")},sel:function(a){}},table:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_table_c"><span data-action="table" title="\u0422\u0430\u0431\u043b\u0438\u0446\u0430" class="tce_tools_btn tce_table-i"></span></span>'},apply:function(a){b.addDpTool({id:a.id,tool:"table",val:a.val,pos:a.t.position(),width:"114px",height:"87px"})},seltd:function(a){$("#"+a.id+" .tce_tools_btn_c.tce_btn_paint_c table td.active").removeClass("active");
for(var c=0;c<a.x;c++)for(var b=0;b<a.y;b++)$("#"+a.id+" .tce_tools_btn_c.tce_btn_paint_c table tr:eq("+c+") td:eq("+b+")").addClass("active")},add:function(a){b.closePop(a);for(var c='<div class="sc_visual_table"><table>',d=0;d<a.x;d++){for(var e="",f=0;f<a.y;f++)e+="<td></td>";c+="<tr>"+e+"</tr>"}c+="</table></div>";"undefined"!=typeof b.param[a.id]&&"undefined"!=typeof b.param[a.id].cont?$(b.param[a.id].cont).after(c):$("#"+a.id+" .tce_content").append(c)},dptool:function(a){for(var c='<div class="tce_tools_btn_c tce_btn_paint_c"><table>',
b=1;6>b;b++){for(var e="",f=1;8>f;f++)e+="<td onClick=\"tsxEd.tools.table.add({t:this,id:'"+a.id+"',x:"+b+",y:"+f+'});" onmouseover="tsxEd.tools.table.seltd({t:this,id:\''+a.id+"',x:"+b+",y:"+f+'});" title="'+f+"x"+b+'">&nbsp;</td>';c+="<tr>"+e+"</tr>"}return c+"</table></div>"},addrow:function(a){if($(b.param[a.id].el).length&&(a=$(b.param[a.id].el).parents("tr:first"),a.length)){a.find("td");var c="";a.find("td").each(function(){var a=$(this).attr("colspan");c+="<td"+(a?' colspan="'+a+'"':"")+"></td>"});
a.after("<tr>"+c+"</tr>")}},addcol:function(a){if($(b.param[a.id].el).length){var c=$(b.param[a.id].el).index();$(b.param[a.id].cont).find("tr").each(function(){$(this).find("td:eq("+c+")").after("<td></td>")})}},delrow:function(a){$(b.param[a.id].el).length&&$(b.param[a.id].el).parents("tr:first").remove()},delcol:function(a){if($(b.param[a.id].el).length){var c=$(b.param[a.id].el).index();$(b.param[a.id].cont).find("tr").each(function(){$(this).find("td:eq("+c+")").remove()})}},joincol:function(a){if($(b.param[a.id].el).length){var c=
$(b.param[a.id].el).next();if(c.length){var d=$(b.param[a.id].el).attr("colspan"),e=c.attr("colspan");d=d?parseInt(d):1;e=e?parseInt(e):1;d+=e;$(b.param[a.id].el).attr({colspan:d});c.remove()}}},splitcol:function(a){if($(b.param[a.id].el).length){var c=parseInt($(b.param[a.id].el).attr("colspan"));if(0<c){for(var d="",e=1;e<c;e++)d+="<td></td>";$(b.param[a.id].el).removeAttr("colspan").after(d)}}},sel:function(a){b.addMinipan({id:a.id},[{tool:"table",action:"addrow",css:"tce_table-addrow",title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443"},
{tool:"table",action:"addcol",css:"tce_table-addcol",title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446"},{tool:"table",action:"delrow",css:"tce_table-delrow",title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u0440\u043e\u043a\u0443"},{tool:"table",action:"delcol",css:"tce_table-delcol",title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446"},{tool:"table",action:"joincol",css:"tce_table-joincol",title:"\u041e\u0431\u044a\u0435\u0434\u0435\u043d\u0438\u0442\u044c \u044f\u0447\u0435\u0439\u043a\u0438"},
{tool:"table",action:"splitcol",css:"tce_table-splitcol",title:"\u0420\u0430\u0437\u0431\u0438\u0442\u044c \u044f\u0447\u0435\u0439\u043a\u0438"}])}},line:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_line_c"><span data-action="line" title="\u041b\u0438\u043d\u0438\u044f" class="tce_tools_btn tce_tools_line"></span></span>'},apply:function(a){b.restoreRange({id:a.id});document.execCommand("insertHorizontalRule")},sel:function(a){}},object:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_object_c"><span data-action="object" title="\u041e\u0431\u044a\u0435\u043a\u0442" class="tce_tools_btn tce_object"></span></span>'},
apply:function(a){if("addCode"==a.action){var c=$("#"+a.id+" .tce_tools_pop_c textarea[name=code]").val();0<c.length&&(c='<div class="nui_iframe">'+c+"</div>","undefined"!=typeof b.param[a.id]&&"undefined"!=typeof b.param[a.id].cont?$(b.param[a.id].cont).after(c):$("#"+a.id+" .tce_content").append(c));b.closePop(a)}else if("saveCode"==a.action){c=$("#"+a.id+" .tce_tools_pop_c textarea[name=code]").val();var d=$("#"+a.id+" .sc_frame_form_xcheckbox[name=del]").hasClass("checked");c&&$(b.param[a.id].el).text(c);
d&&($(b.param[a.id].el).remove(),b.param[a.id]=void 0);b.closePop(a)}else b.addPop({id:a.id,title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442 \u0438\u043b\u0438 \u043a\u043e\u0434",content:'<div class="tce_tools_pop_form_c"><div class="tce_tools_pop_form_i"><textarea placeholder="\u0412\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043a\u043e\u0434" name="code"></textarea></div></div>',button:[{title:"OK",tools:"object",action:"addCode",active:1},{title:"\u041e\u0442\u043c\u0435\u043d\u0430",
action:"close"}]})},sel:function(a){var c=$(b.param[a.id].el).text();b.addPop({id:a.id,title:"\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0438\u043b\u0438 \u043a\u043e\u0434",content:'<div class="tce_tools_pop_form_c"><div class="tce_tools_pop_form_i"><textarea placeholder="\u0412\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043a\u043e\u0434" name="code">'+c+'</textarea></div><div class="tce_tools_pop_form_i"><label></label><span onclick="$(this).children().toggleClass(\'checked\');" class="sc_frame_form_xlable"><span name="del" data-value="1" class="sc_frame_form_checkbox sc_frame_form_xcheckbox"></span> \u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b</span></div></div>',
button:[{title:"OK",tools:"object",action:"saveCode",active:1},{title:"\u041e\u0442\u043c\u0435\u043d\u0430",action:"close"}]})}},html:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_html_c"><span data-action="html" data-val="show" title="\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434" class="tce_tools_btn tce_html-i"></span></span>'},apply:function(a){b.changeType({id:a.id})},sel:function(a){}},style:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_style_c"><span data-action="style" data-val="show" title="\u0421\u0442\u0438\u043b\u0438" class="tce_tools_btn tce_style-i"></span></span>'},
apply:function(a){if("addstyle"==a.action){if(b.param[a.id].cont){var c=$("#"+a.id+" .tce_tools_pop_c select[name=cstyle] option:selected").val(),d=[];for(e in b.custom_style)b.custom_style[e].v&&d.push(b.custom_style[e].v);var e="";var f=b.param[a.id].cont.attr("class");if(f){var g=f.split(" ");for(f=0;f<g.length;f++)b.inArray(g[f],d)||(e+=g[f]+" ")}c&&(e+=c+" ");b.param[a.id].cont.attr("class",e.trim());b.closePop({id:a.id})}}else if(b.closePop({id:a.id}),b.param[a.id].cont){c="";g=[];(f=b.param[a.id].cont.attr("class"))&&
(g=f.split(" "));for(e in b.custom_style)b.custom_style[e].v&&(d=b.inArray(b.custom_style[e].v,g)?" selected":"",c+="<option"+d+' value="'+b.custom_style[e].v+'">'+b.custom_style[e].n+"</option>");b.addPop({id:a.id,title:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c",content:'<div class="tce_tools_pop_form_c"><div class="tce_tools_pop_form_i"><label>\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u0438\u043b\u044f</label><select name="cstyle"><option value="">\u0411\u0435\u0437 \u0441\u0442\u0438\u043b\u044f</option>'+
c+"</select></div></div>",button:[{title:"OK",tools:"style",action:"addstyle",active:1},{title:"\u041e\u0442\u043c\u0435\u043d\u0430",action:"close"}]})}},sel:function(a){}},movie:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_movie_c"><span data-action="movie" title="\u041e\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0432\u043d\u0438\u0437" class="tce_tools_btn tce_movie-down"></span><span data-action="movie" title="\u041f\u043e\u0434\u043d\u044f\u0442\u044c \u0432\u0432\u0435\u0440\u0445" data-val="up" class="tce_tools_btn tce_movie-up"></span></span>'},
apply:function(a){b.closePop({id:a.id});if($(b.param[a.id].cont).length){if("table"==b.param[a.id].conttagname){var c=$(b.param[a.id].cont).parents(".sc_visual_table:first");c=c.length?c:$(b.param[a.id].cont)}else c=$(b.param[a.id].cont);a=a.val?a.val:"down";"up"==a?(a=c.prev(),a.length&&c.insertBefore(a)):"down"==a&&(a=c.next(),a.length&&c.insertAfter(a))}},sel:function(a){}},del:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_del_c"><span data-action="del" title="\u0423\u0434\u0430\u043b\u0438\u0442\u044c" class="tce_tools_btn tce_del"></span></span>'},
apply:function(a){var c=b.param[a.id].el,d=b.param[a.id].tagname;"p"==d||"h1"==d||"h2"==d||"h3"==d||"h4"==d||"blockquote"==d||"hr"==d||"obj"==d||"stick"==d?$(c).remove():"li"==d?$(c).parent().remove():"td"==d||"th"==d?(c.parents(".sc_visual_table:first").remove(),c.parents("table:first").remove()):"b"==d||"strong"==d||"i"==d||"em"==d||"u"==d||"span"==d&&("line-through"==$(c).css("text-decoration")||"underline"==$(c).css("text-decoration"))?$(c).contents().unwrap():"img"==d&&(d=c.parents(".nui_images_container:first"),
$(c).remove(),0==d.find("img").length&&d.remove());b.closePop({id:a.id});b.param[a.id]=void 0},sel:function(a){}},blank:{button:function(a){},apply:function(a){},sel:function(a){}}};this.changeType=function(a){if(a.id){var c=a.id;$("#sc_code_editor_"+c).length&&"block"==$("#sc_code_editor_"+c).css("display")?((a=$("#sc_code_editor_"+c).text())&&(a=b.clearCode(a)),$("#"+c+" .tce_content").html(a).show(),$("#sc_code_editor_"+c).hide(),$("#"+c+" .tce_tools_c").removeClass("sc_html_mode")):(b.closePop({id:a.id}),
a=$("#"+c+" .tce_content").html(),a=b.formatCode(b.clearCode(a)),$("#sc_code_editor_"+c).text(a).show().focus(),$("#"+c+" .tce_content").hide(),$("#"+c+" .tce_tools_c").addClass("sc_html_mode"))}};this.clearCode=function(a){a&&(a=a.replace(/<p><br><\/p>/gi,"").replace(/<p>\n<br><\/p>/gi,"").replace(/<p><\/p>/gi,""));return a};this.formatCode=function(a){a&&(a=a.replace(/<(p|h1|h2|h3|h4|br|ul|ol|table|tbody|blockquote|div|tr|td|li)(.*?)>/gi,"\n<$1$2>").replace(/<(tr|td|li)(.*?)>/gi,"\n\t<$1$2>").replace(/<\/(table|tbody|tr|div|ul|ol)>/gi,
"</$1>\n"),a=a.replace(/(\n){1,}/g,"\n").replace(/(\n\t){1,}/g,"\n\t").trim());return a};this.codeColor=function(a){return a=a.replace(/&lt;(h1|h2|h3|h4|h5|a|textarea|b|strong|i|em|div|span|p|img|ul|ol|li|b|i|blockquote|br)((?:\s{1}[a-zA-Z]+="[^"]*"{1}\s*)*)&gt;{1}/gi,'<i class="sc_tag">&lt;$1<i class="sc_tag_attr">$2</i>&gt;</i>').replace(/&lt;\/(h1|h2|h3|h4|h5|a|textarea|b|strong|i|em|div|span|p|img|ul|ol|li|b|i|blockquote)&gt;{1}/gi,'<i class="sc_tag">&lt;/$1&gt;</i>')};this.formatTag=function(a){window.document.execCommand(a,
!1,null);return!1};this.saveArea=function(a){if(a&&a.id){b.closePop({id:a.id});var c=!1;if($("#sc_code_editor_"+a.id).length&&"block"==$("#sc_code_editor_"+a.id).css("display")){c=!0;var d=$("#sc_code_editor_"+a.id)}else d=$("#"+a.id+" .tce_content");if(d.length&&(c=c?d.text():d.html(),$(b.textarea[a.id]).val(c),"function"==typeof a.callback&&a.callback({id:a.id,ta:b.textarea[a.id]}),a["return"]))return c}};this.addMinipan=function(a,c){$("#"+a.id+" .tce_content sub").remove();var d=$(b.param[a.id].el).position(),
e="";for(f in c)b.tools[c[f].tool][c[f].action]&&(e+="<span"+(c[f].title?' title="'+c[f].title+'"':"")+" onClick=\"tsxEd.tools['"+c[f].tool+"']['"+c[f].action+"']({id:'"+a.id+'\',t:$(this)});" class="tce_tools_btn '+c[f].css+'"></span>');var f=d.top-30;f=1>f?1:f;$("#"+a.id+" .tce_content").append('<sub alt="'+a.id+'" contenteditable="false" style="top:'+f+"px; left:"+(d.left+5)+'px" id="sc_visual_minipan_'+a.id+'" class="sc_visual_minipan">'+e+"</sub>");$("#sc_visual_minipan_"+a.id).fadeIn(300)};
this.inArray=function(a,c){for(var b=0;b<c.length;b++)if(c[b]==a)return!0;return!1};this.addDpTool=function(a){if(a&&a.id&&a.tool){$("#"+a.id+" .tce_dp_tools_c").remove();var c=b.tools[a.tool].dptool?b.tools[a.tool].dptool({val:a.val,id:a.id}):"",d="";a.width&&(d+="width:"+a.width+";");a.height&&(d+="height:"+a.height+";");a.pos&&a.pos.left&&(d+="left:"+a.pos.left+"px;");$("#"+a.id).append("<div onClick=\"tsxEd.closePop({t:this,id:'"+a.id+'\'})" class="tce_tools_popbg_c"></div><div style="'+d+'" class="tce_dp_tools_c">'+
c+"</div>")}};this.addPop=function(a){if(a&&a.id){$("#"+a.id+" .tce_tools_pop_c, #"+a.id+" .tce_tools_popbg_c").remove();var c="";a.width&&(c+="width:"+a.width+";");a.height&&(c+="height:"+a.height+";");var b=a&&a.title?'<div class="tce_tools_pop_t">'+a.title+"</div>":"",e=a&&a.content?'<div class="tce_tools_pop">'+a.content+"</div>":"",f="";if(a&&a.button){f+='<div class="tce_tools_pop_btn_c">';for(var g in a.button)if(a.button[g].title){var k=a.button[g].active?" active":"",h="";"close"==a.button[g].action?
h="tsxEd.closePop({t:this,id:'"+a.id+"'});":a.button[g].action&&a.button[g].tools&&(h="tsxEd.tools['"+a.button[g].tools+"'].apply({id:'"+a.id+"',action:'"+a.button[g].action+"'});");f+='<span onClick="'+h+'" class="tce_tools_pop_btn'+k+'">'+a.button[g].title+"</span>"}f+="</div>"}$("#"+a.id).append('<div class="tce_tools_popbg_c"></div><div style="'+c+'" class="tce_tools_pop_c"><span onClick="tsxEd.closePop({t:this,id:\''+a.id+'\'});" class="tce_tools_pop_close"></span>'+b+'<div class="tce_tools_pop">'+
e+"</div>"+f+"</div>")}};this.closePop=function(a){$("#"+a.id+" .tce_tools_popbg_c, #"+a.id+" .tce_tools_pop_c, #"+a.id+" .tce_dp_tools_c, #"+a.id+" .sc_visual_minipan").remove();$("#"+a.id+" .tce_tools_select_activate").removeClass("tce_tools_select_activate")};this.numberPlus=function(a){if(a&&a.t){b.restoreRange({id:a.id});var c=$(a.t).parent().find(".tce_tools_numric_tx"),d=c.attr("data-min")?parseInt(c.attr("data-min")):0,e=c.attr("data-max")?parseInt(c.attr("data-max")):0,f=c.text();f=f?parseInt(f):
d;d=a.s?f-1>=d?f-1:f:f+1<=e?f+1:f;f!=d&&a.action&&b.tools[a.action].apply&&b.tools[a.action].apply({val:d,id:a.id})&&c.text(d)}};this.editElm=function(a){if(a=b.detectEl({t:a.t})){$("#"+a+" .sc_visual_active").removeClass("sc_visual_active");$("#"+a+" .tce_content sub").remove();$("#"+a+" .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active");if("h1"==b.param[a].conttagname||"h2"==b.param[a].conttagname||"h3"==b.param[a].conttagname||"h4"==b.param[a].conttagname||"p"==b.param[a].conttagname||
"blockquote"==b.param[a].conttagname)b.tools.format.sel({tn:b.param[a].conttagname,id:a}),b.tools.font.sel({tn:b.param[a].conttagname,id:a}),b.tools.fontsize.sel({tn:b.param[a].conttagname,etn:b.param[a].tagname,id:a}),b.tools.align.sel({tn:b.param[a].conttagname,id:a}),$(b.param[a].el).hasClass("nui_images_container")&&$(b.param[a].el).addClass("sc_visual_active");if("b"==b.param[a].tagname||"strong"==b.param[a].tagname||"i"==b.param[a].tagname||"em"==b.param[a].tagname||"u"==b.param[a].tagname||
"s"==b.param[a].tagname||"strike"==b.param[a].tagname||"span"==b.param[a].tagname)b.tools.mark.sel({tn:b.param[a].tagname,id:a});else if("a"==b.param[a].tagname){if(1==b.activelink){var c=$(b.param[a].el).attr("href");c&&window.open(c)}b.tools.paint.sel({tn:b.param[a].tagname,id:a})}else"img"==b.param[a].tagname?b.tools.img.sel({tn:b.param[a].tagname,id:a}):"td"==b.param[a].tagname||"th"==b.param[a].tagname?($(b.param[a].el).addClass("sc_visual_active"),b.tools.table.sel({tn:b.param[a].tagname,id:a})):
"div"==b.param[a].tagname&&$(b.param[a].el).hasClass("nui_iframe")&&($(b.param[a].el).addClass("sc_visual_active"),b.tools.object.sel({tn:b.param[a].tagname,id:a}))}};this.detectEl=function(a){var c=!1;a&&a.t?c=$(a.t):a&&a.id&&(c=$(a.id));if(0!=c&&(a=c.parents(".tce_content_c").attr("id"))){var d=c.get(0).tagName.toLowerCase(),e=c,f=d;if("td"==d||"th"==d){var g=c.parents("table:first");g.length&&(e=g,f="table")}else if("p"!=d||"ul"!=d||"ol"!=d)g=c.parents("p:first"),g.length&&(e=g,f=g.get(0).tagName.toLowerCase());
b.param[a]={};b.param[a].tagname=d;b.param[a].conttagname=f;b.param[a].cont=e;b.param[a].el=c;return a}};this.showOption=function(a){a&&a.t&&($(a.t).addClass("tce_tools_select_activate"),$("#"+a.id).append("<div onClick=\"tsxEd.closePop({t:this,id:'"+a.id+'\'})" class="tce_tools_popbg_c"></div>'))};this.getOption=function(a){var c="";if(a&&a.options&&a.name){c+="<span onClick=\"tsxEd.showOption({t:this,id:'"+a.id+'\'});" class="tce_tools_select_c tce_tools_select_'+a.name+'"><span class="tce_tools_select">';
for(var b in a.options)a.options[b].val&&(c+='<span onClick="tsxEd.getOptionVal(this);" data-id="'+a.id+'" data-name="'+a.name+'" data-value="'+a.options[b].val+'" class="tce_tools_select_option'+(a.options[b].selected?" tce_tools_selected":"")+(a.options[b].css?" "+a.options[b].css:"")+'">'+a.options[b].name+"</span>");c+="</span></span>"}return c};this.getOptionVal=function(a){if(a&&$(a).parents(".tce_tools_select_activate").length){var c=$(a).attr("data-value");c=c?c:"";var d=$(a).attr("data-name"),
e=$(a).attr("data-id");d&&b.tools[d].apply&&(b.tools[d].apply({val:c,t:a,id:e}),$(a).parent().find(".tce_tools_selected").removeClass("tce_tools_selected"),$(a).addClass("tce_tools_selected"),setTimeout(function(){$(a).parents(".tce_tools_select_activate").removeClass("tce_tools_select_activate");b.closePop({id:e})},.1))}};this.keyUp=function(a){a.e&&8==a.e.keyCode&&(a=a.id,$("#"+a+" .tce_content p, #"+a+" .tce_content div, #"+a+" .tce_content h1, #"+a+" .tce_content h2, #"+a+" .tce_content h3, #"+
a+" .tce_content h4, #"+a+" .tce_content blockquote, #"+a+" .tce_content ul, #"+a+" .tce_content ol").length||(document.execCommand("insertHTML",!1,'<p id="tce-replacer"></p>'),b.detectEl({id:"#"+a+" #tce-replacer"}),$("#"+a+" #tce-replacer").removeAttr("id")))};this.pasteFormat=function(a){a.id&&$("#"+a.id+" .tce_content").msword_html_filter()};this.pasteCodeFormat=function(a){a.id&&setTimeout(function(){$("#sc_code_editor_"+a.id).text($("#sc_code_editor_"+a.id).text())},.001)};this.stripTags=function(a,
c){c=(((c||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return a.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(a,b){return-1<c.indexOf("<"+b.toLowerCase()+">")?a:""})};this.uid=function(){return"_"+Math.random().toString(36).substr(2,9)};this.saveRange=function(a){if(a&&a.id){"undefined"==typeof b.param[a.id]&&(b.param[a.id]={});b.param[a.id].range=null;var c=window.getSelection();0<c.rangeCount&&(b.param[a.id].range=
c.getRangeAt(0))}};this.restoreRange=function(a){a&&a.id&&"undefined"!=typeof b.param[a.id]&&(a=b.param[a.id].range)&&(window.getSelection?(s=window.getSelection(),0<s.rangeCount&&s.removeAllRanges(),s.addRange(a)):document.selection&&a.select())};this.htmlspecialchars=function(a){"string"==typeof a&&(a=a.replace(/&/g,"&amp;"),a=a.replace(/"/g,"&quot;"),a=a.replace(/'/g,"&#039;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"));return a}}var tsxEd=new tsxEdClass;