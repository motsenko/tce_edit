function tsxEdClass(){this.eid=0;this.param={};this.textarea={};this.font_array={arial:"Arial, Helvetica, sans-serif",georgia:"Georgia, serif",tahoma:"Tahoma, Geneva, sans-serif",times:"'Times New Roman', Times, serif",verdana:"Verdana, Geneva, sans-serif"};var c=this;this.init=function(a){document.execCommand("defaultParagraphSeparator",!1,"p");if(a&&a.targ&&$(a.targ).length){c.eid="tsx"+c.uid();c.textarea[c.eid]=a.targ;var b=$(a.targ).val();""==b.trim()&&(b="<p></p>");b=b?b.replace(RegExp('src="edit/uploads',
"gm"),'src="/edit/uploads'):"";var d="";if(a&&a.tools){var e=a.tools.split(",");for(f in e)"undefined"!=typeof c.tools[e[f]]&&"undefined"!=typeof c.tools[e[f]].button&&(d+=c.tools[e[f]].button({id:c.eid}))}d=d?'<div data-id="'+c.eid+'" class="tce_tools_c">'+d+"</div>":"";e=a&&1==a.disable?"":' contenteditable="true"';var f='<div style="display:none;" ondragenter="return false;" ondragleave="return false;" ondragover="return false;" ondrop="return false;" id="sc_code_editor_'+c.eid+'" class="sc_code_editor_c" contenteditable="true">'+
c.htmlspecialchars(b)+"</div>";$(a.targ).before('<div id="'+c.eid+'" class="tce_content_c">'+d+'<div class="tce_content_x sc_editor_container"><div'+e+' class="tce_content">'+b+"</div>"+f+"</div></div>").hide();b=document.createElement("p");d=$("#"+c.eid+" .tce_content").get(0);(e=d.firstChild)&&"#text"==e.nodeName&&(b.appendChild(e),d.prepend(b));document.getElementById(c.eid).addEventListener("paste",function(a){if($(a.target).parents(".tce_content").length){a.preventDefault();var b="";textarr=
a.clipboardData.getData("text/plain").trim().split("\n");if(textarr.length)for(a=0;a<textarr.length;a++)textarr[a].trim()&&(b+="<p>"+textarr[a].trim()+"</p>");b&&document.execCommand("insertHTML",!1,b)}else if($(a.target).hasClass("sc_code_editor_c")||$(a.target).parents(".sc_code_editor_c").length)b=$(a.target).parents(".tce_content_c").attr("id"),c.pasteCodeFormat({e:a,id:b})});$("#sc_code_editor_"+c.eid).on("keydown",function(a){$(a.target).parents(".tce_content_c").attr("id");if($(a.target).hasClass("sc_code_editor_c")){if(13==
a.keyCode)return a.preventDefault(),document.execCommand("insertHTML",!1,"\n"),a.stopPropagation(),!1;if(9==a.keyCode)return document.execCommand("insertHTML",!1,"\t"),!1}});$("#"+c.eid).on("keyup",function(a){var b=$(a.target).parents(".tce_content_c").attr("id");c.keyUp({e:a,id:b})});$("#"+c.eid+" .tce_content").on("click","img,p,h1,h2,h3,h4,li,ul,ol,td,th,table,blockquote,a,b,strong,i,em,u,s,strike,span",function(b){b.stopPropagation();1!=a.disable&&c.editElm({e:b,t:this})});$("#"+c.eid).on("mousedown",
".tce_tools_btn",function(a){a=$(this).parents(".tce_content_c").attr("id");c.saveRange({id:a})});$("#"+c.eid).on("click",".tce_tools_btn",function(b){var d=$(this).parents(".tce_content_c").attr("id");if(d&&1!=a.disable){c.restoreRange({id:d});b.stopPropagation();$(this).parent().find(".tce_tools_btn_active").removeClass("tce_tools_btn_active");b=$(this).attr("data-action");var e=$(this).attr("data-val");b&&c.tools[b].apply&&c.tools[b].apply({val:e,id:d,t:$(this)});$(this).addClass("tce_tools_btn_active")}});
return c.eid}};this.tools={format:{button:function(a){return c.getOption({name:"format",id:a.id,options:[{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 1",val:"h1",css:"h1"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 2",val:"h2",css:"h2"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 3",val:"h3",css:"h3"},{name:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a 4",val:"h4",css:"h4"},{name:"\u041f\u0430\u0440\u0430\u0433\u0440\u0430\u0444",val:"p",
selected:!0,css:"p"},{name:"\u0426\u0438\u0442\u0430\u0442\u0430",val:"blockquote",css:"blockquote"}]})},apply:function(a){var b=a.id;!b||"undefined"==typeof c.param[b]||"h1"!=c.param[b].conttagname&&"h2"!=c.param[b].conttagname&&"h3"!=c.param[b].conttagname&&"h4"!=c.param[b].conttagname&&"p"!=c.param[b].conttagname&&"blockquote"!=c.param[b].conttagname||($(c.param[b].cont).replaceWith(function(b,c){return $("<"+a.val+' id="tce-replacer">').html(c)}),c.detectEl({id:"#"+b+" #tce-replacer"}),$("#"+
b+" #tce-replacer").removeAttr("id"))},sel:function(a){var b=a.id;a&&b&&a.tn&&$("#"+b+" .tce_tools_select_format .tce_tools_select_option."+a.tn).length&&($("#"+b+" .tce_tools_select_format .tce_tools_selected").removeClass("tce_tools_selected"),$("#"+b+" .tce_tools_select_format .tce_tools_select_option."+a.tn).addClass("tce_tools_selected"))}},align:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_align_c"><span data-action="align" data-val="left" title="\u041f\u043e \u043b\u0435\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e" class="tce_tools_btn tce_align-left"></span><span data-action="align" data-val="center" title="\u041f\u043e \u0446\u0435\u043d\u0442\u0440\u0443" class="tce_tools_btn tce_align-center"></span><span data-action="align" data-val="right" title="\u041f\u043e \u043f\u0440\u0430\u0432\u043e\u043c\u0443 \u043a\u0440\u0430\u044e" class="tce_tools_btn tce_align-right"></span><span data-action="align" data-val="justify" title="\u041f\u043e \u0448\u0438\u0440\u0438\u043d\u0435" class="tce_tools_btn tce_align-justify"></span></span>'},
apply:function(a){var b=a.id;b&&"undefined"!=typeof c.param[b]&&("h1"==c.param[b].conttagname||"h2"==c.param[b].conttagname||"h3"==c.param[b].conttagname||"h4"==c.param[b].conttagname||"p"==c.param[b].conttagname||"blockquote"==c.param[b].conttagname)&&a.val&&($(c.param[b].cont).css("text-align",a.val),$("#"+b+" .tce_btn_align_c .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active"),$("#"+b+" .tce_tools_btn.tce_align-"+a.val).addClass("tce_tools_btn_active"))},sel:function(a){var b=
a.id;a&&b&&a.tn&&(a=$(c.param[b].cont).css("text-align"),a="start"==a?"left":a,$("#"+b+" .tce_btn_align_c .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active"),$("#"+b+" .tce_tools_btn.tce_align-"+a).addClass("tce_tools_btn_active"))}},mark:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_mark_c"><span data-action="mark" data-val="bold" title="\u0416\u0438\u0440\u043d\u044b\u0439" class="tce_tools_btn tce_mark-b"></span><span data-action="mark" data-val="italic" title="\u041a\u0443\u0440\u0441\u0438\u0432" class="tce_tools_btn tce_mark-i"></span><span data-action="mark" data-val="underline" title="\u041f\u043e\u0434\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439" class="tce_tools_btn tce_mark-u"></span><span data-action="mark" data-val="strikethrough" title="\u041f\u0435\u0440\u0435\u0447\u0435\u0440\u043a\u043d\u0443\u0442\u044b\u0439" class="tce_tools_btn tce_mark-s"></span></span>'},
apply:function(a){var b=a.id;if(b&&"undefined"!=typeof c.param[b]){var d=window.getSelection();if("undefind"!=typeof d&&d.isCollapsed){if($(c.param[b].el).parents(".tce_content").length&&("b"==c.param[b].tagname||"strong"==c.param[b].tagname||"i"==c.param[b].tagname||"em"==c.param[b].tagname||"u"==c.param[b].tagname||"s"==c.param[b].tagname||"strike"==c.param[b].tagname||"span"==c.param[b].tagname)){var e="";"bold"==a.val?e="strong":"italic"==a.val?e="em":"underline"==a.val?e="u":"strikethrough"==
a.val&&(e="strike");$(c.param[b].el).replaceWith(function(a,b){return $("<"+e+' id="tce-replacer">').html(b)});c.detectEl({id:"#"+b+" #tce-replacer"});$("#"+b+" #tce-replacer").removeAttr("id")}}else 0<d.rangeCount&&(b=d.getRangeAt(0),$(b.commonAncestorContainer).parents(".tce_content").length&&document.execCommand(a.val))}},sel:function(a){var b=a.id;a&&b&&a.tn&&("span"==a.tn?"line-through"==$(c.param[b].el).css("text-decoration-line")?$("#"+b+" .tce_tools_btn.tce_mark-s").addClass("tce_tools_btn_active"):
"underline"==$(c.param[b].el).css("text-decoration-line")&&$("#"+b+" .tce_tools_btn.tce_mark-u").addClass("tce_tools_btn_active"):(a="strong"==a.tn?"b":"em"==a.tn?"i":"strike"==a.tn?"s":a.tn,$("#"+b+" .tce_tools_btn.tce_mark-"+a).addClass("tce_tools_btn_active")))}},font:{button:function(a){return c.getOption({name:"font",id:a.id,options:[{name:"Arial",selected:!0,val:"arial",css:"arial"},{name:"Georgia",val:"georgia",css:"georgia"},{name:"Tahoma",val:"tahoma",css:"tahoma"},{name:"Times New",val:"times",
css:"times"},{name:"Verdana",val:"verdana",css:"verdana"}]})},apply:function(a){var b=a.id;b&&"undefined"!=typeof c.param[b]&&("h1"==c.param[b].conttagname||"h2"==c.param[b].conttagname||"h3"==c.param[b].conttagname||"h4"==c.param[b].conttagname||"p"==c.param[b].conttagname||"blockquote"==c.param[b].conttagname)&&c.font_array[a.val]&&$(c.param[b].cont).css("font-family",c.font_array[a.val])},sel:function(a){var b=a.id;a&&b&&a.tn&&(font=$(c.param[b].cont).css("font-family").split(" "),font=font[0].replace(",",
"").replace("'","").replace('"',"").toLowerCase(),$("#"+b+" .tce_tools_select_font .tce_tools_selected").removeClass("tce_tools_selected"),$("#"+b+" .tce_tools_select_font .tce_tools_select_option."+font).addClass("tce_tools_selected"))}},fontsize:{button:function(a){return'<span class="tce_tools_numric_c tce_btn_fontsize_c"><span data-min="9" data-max="46" class="tce_tools_numric_tx">14</span><span onClick="tsxEd.numberPlus({t:this,action:\'fontsize\',id:\''+a.id+"'});\" class=\"tce_tools_numric_up\"></span><span onClick=\"tsxEd.numberPlus({t:this,s:1,action:'fontsize',id:'"+
a.id+'\'});" class="tce_tools_numric_dw"></span></span>'},apply:function(a){var b=a.id;if(b&&"undefined"!=typeof c.param[b]){var d=window.getSelection();if(d.isCollapsed){if("span"==c.param[b].tagname)return $(c.param[b].el).css("font-size",a.val+"px"),!0;if("h1"==c.param[b].conttagname||"h2"==c.param[b].conttagname||"h3"==c.param[b].conttagname||"h4"==c.param[b].conttagname||"p"==c.param[b].conttagname||"blockquote"==c.param[b].conttagname)return $(c.param[b].cont).css("font-size",a.val+"px"),!0}else if(0<
d.rangeCount&&(d=d.getRangeAt(0),$(d.commonAncestorContainer).parents(".tce_content").length))return a=$("<span/>",{text:document.getSelection()}).css("font-size",a.val+"px").attr("id","tce-replacer").prop("outerHTML"),document.execCommand("insertHTML",!1,a),c.detectEl({id:"#"+b+" #tce-replacer"}),$("#"+b+" #tce-replacer").removeAttr("id"),!0}},sel:function(a){var b=a.id;if("span"==a.etn)var d=$(c.param[b].el).css("font-size");else if("h1"==a.tn||"h2"==a.tn||"h3"==a.tn||"h4"==a.tn||"p"==a.tn||"blockquote"==
a.tn)d=$(c.param[b].cont).css("font-size");d&&(a=parseInt(d))&&$("#"+b+" .tce_btn_fontsize_c .tce_tools_numric_tx").text(a)}},paint:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_paint_c"><span data-action="paint" data-val="foreColor" title="\u0426\u0432\u0435\u0442 \u0442\u0435\u043a\u0441\u0442\u0430" class="tce_tools_btn tce_paint-tc"></span><span data-action="paint" data-val="backColor" title="\u0426\u0432\u0435\u0442 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430" class="tce_tools_btn tce_paint-tm"></span><span data-action="paint" data-val="link" title="\u0421\u0441\u044b\u043b\u043a\u0430" class="tce_tools_btn tce_paint-link"></span></span>'},
apply:function(a){var b=window.getSelection();if("addlink"==a.action){var d=$("#"+a.id+" .tce_tools_pop_c input[name=src]").val();if(0==d.length)return $("#"+a.id+" .tce_tools_pop_c input[name=src]").addClass("error").focus(),!1;$("#"+a.id+" .tce_tools_pop_c input[name=src]").removeClass("error");b=$("#"+a.id+" .tce_tools_pop_c input[name=text]").val();if(0==b.length)return $("#"+a.id+" .tce_tools_pop_c input[name=text]").addClass("error").focus(),!1;$("#"+a.id+" .tce_tools_pop_c input[name=text]").removeClass("error");
var e=$("#"+a.id+" .tce_tools_pop_c input[name=title]").val(),f=$("#"+a.id+" .sc_frame_form_xcheckbox").hasClass("checked");"a"==c.param[a.id].tagname?($(c.param[a.id].el).attr("href",d).text(b),e&&$(c.param[a.id].el).attr("title",e),f&&$(c.param[a.id].el).attr("target","_blank")):(c.restoreRange({id:a.id}),document.execCommand("insertHTML",!1,"<a"+(f?' target="_blank"':"")+' href="'+d+'">'+b+"</a>"));c.closePop({id:a.id})}else if(0<b.rangeCount||"a"==a.tn)"backColor"==a.val||"foreColor"==a.val?$(a.t).attr("data-color")?
("null"!=$(a.t).attr("data-color")?document.execCommand(a.val,!1,$(a.t).attr("data-color")):document.execCommand("removeFormat",!1,a.val),$("#"+a.id+" .tce_tools_popbg_c, #"+a.id+" .tce_dp_tools_c").remove()):c.addDpTool({id:a.id,tool:"paint",val:a.val,pos:a.t.position(),width:"114px",height:"85px"}):"link"==a.val&&(d="",b=b?b:"",f=e="","a"==c.param[a.id].tagname&&(d=$(c.param[a.id].el).attr("href"),b=$(c.param[a.id].el).text(),e=(e=$(c.param[a.id].el).attr("title"))?e:"",f="_blank"==$(c.param[a.id].el).attr("target")?
" checked":""),c.addPop({id:a.id,title:"\u0421\u0441\u044b\u043b\u043a\u0430",content:'<div class="tce_tools_pop_form_c"><div class="tce_tools_pop_form_i"><label>\u0410\u0434\u0440\u0435\u0441 \u0441\u0441\u044b\u043b\u043a\u0438</label><input value="'+d+'" placeholder="https://" name="src" type="text" /></div><div class="tce_tools_pop_form_i"><label>\u0422\u0435\u043a\u0441\u0442 \u0441\u0441\u044b\u043b\u043a\u0438</label><input value="'+b+'" name="text" value="'+c.param[a.id].range+'" type="text" /></div><div class="tce_tools_pop_form_i"><label>\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a</label><input value="'+
e+'" name="title" type="text" /></div><div class="tce_tools_pop_form_i"><label></label><span onclick="$(this).children().toggleClass(\'checked\');" class="sc_frame_form_xlable"><span name="blank" data-value="1" class="sc_frame_form_checkbox sc_frame_form_xcheckbox'+f+'"></span> \u041e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0432 \u043d\u043e\u0432\u043e\u043c \u043e\u043a\u043d\u0435</span></div></div>',button:[{title:"OK",tools:"paint",action:"addlink",active:1},{title:"\u041e\u0442\u043c\u0435\u043d\u0430",
action:"close"}]}))},dptool:function(a){for(var b="#f44336 #ff9800 #ffc107 #ffeb3b #8bc34a #4caf50 #009688 #03a9f4 #3f51b5 #673ab7 #9c27b0 null".split(" "),c='<span class="tce_tools_btn_c tce_btn_paint_c">',e=0;e<b.length;e++)c+='<span data-action="paint" data-val="'+a.val+'" data-color="'+b[e]+'" style="background:'+b[e]+';" class="tce_tools_btn"></span>';return c+"</span>"},sel:function(a){var b=a.id;a&&b&&a.tn&&"a"==a.tn&&$("#"+b+" .tce_paint-link").addClass("tce_tools_btn_active")}},files:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_file_c"><span data-action="files" title="\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f" class="tce_tools_btn tce_img-add"></span><span data-action="files" data-val="file" title="\u0424\u0430\u0439\u043b\u044b" class="tce_tools_btn tce_file-add"></span></span>'},
apply:function(a){scHp.filesOpen(a.id,"file"==a.val?"txt,pdf,doc,docx,xls,xlsx":!1)},add:function(a){if(a.id&&1==a.file)"undefined"!=typeof c.param[a.id]&&"undefined"!=typeof c.param[a.id].cont?(c.restoreRange({id:a.id}),document.execCommand("insertHTML",!1,a.list)):$("#"+a.id+" .tce_content").append("<p>"+a.list+"</p>");else if(a.id&&a.imgs.length){for(var b="",d=0;d<a.imgs.length;d++)if(a.imgs[d])if(a.zoom){var e=a.imgs[d].split("/");e[e.length-1]=".thumb_"+e[e.length-1];imgi=e.join("/");b+='<img class="lifs_photo" src="'+
imgi+'"/>'}else b+=a.block?'<p class="nui_images_container"><img src="'+a.imgs[d]+'"/></p>':'<img src="'+a.imgs[d]+'"/>';a.zoom&&(b='<p class="nui_images_container">'+b+"</p>");"undefined"!=typeof c.param[a.id]?c.param[a.id].cont?a.zoom||a.block?$(c.param[a.id].cont).after(b):(c.restoreRange({id:a.id}),document.execCommand("insertHTML",!1,b)):$("#"+a.id+" .tce_content").append(b):$("#"+a.id+" .tce_content").append(b)}},sel:function(a){$("#"+a.id+" .tce_img-add").addClass("tce_tools_btn_active")}},
list:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_list_c"><span data-action="list" title="\u0421\u043f\u0438\u0441\u043e\u043a" class="tce_tools_btn tce_list-ul"></span><span data-action="list" data-val="ol" title="\u041d\u0443\u043c\u0435\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a" class="tce_tools_btn tce_list-ol"></span></span>'},apply:function(a){c.restoreRange({id:a.id});document.execCommand("ol"==a.val?"insertorderedlist":"insertUnorderedList")},
sel:function(a){}},table:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_table_c"><span data-action="table" title="\u0422\u0430\u0431\u043b\u0438\u0446\u0430" class="tce_tools_btn tce_table-i"></span></span>'},apply:function(a){c.addDpTool({id:a.id,tool:"table",val:a.val,pos:a.t.position(),width:"114px",height:"87px"})},seltd:function(a){$("#"+a.id+" .tce_tools_btn_c.tce_btn_paint_c table td.active").removeClass("active");for(var b=0;b<a.x;b++)for(var c=0;c<a.y;c++)$("#"+a.id+" .tce_tools_btn_c.tce_btn_paint_c table tr:eq("+
b+") td:eq("+c+")").addClass("active")},add:function(a){c.closePop(a);for(var b='<div class="sc_visual_table"><table>',d=0;d<a.x;d++){for(var e="",f=0;f<a.y;f++)e+="<td></td>";b+="<tr>"+e+"</tr>"}b+="</table></div>";"undefined"!=typeof c.param[a.id]&&"undefined"!=typeof c.param[a.id].cont?$(c.param[a.id].cont).after(b):$("#"+a.id+" .tce_content").append(b)},dptool:function(a){for(var b='<div class="tce_tools_btn_c tce_btn_paint_c"><table>',c=1;6>c;c++){for(var e="",f=1;8>f;f++)e+="<td onClick=\"tsxEd.tools.table.add({t:this,id:'"+
a.id+"',x:"+c+",y:"+f+'});" onmouseover="tsxEd.tools.table.seltd({t:this,id:\''+a.id+"',x:"+c+",y:"+f+'});" title="'+f+"x"+c+'">&nbsp;</td>';b+="<tr>"+e+"</tr>"}return b+"</table></div>"},addrow:function(a){if($(c.param[a.id].el).length&&(a=$(c.param[a.id].el).parents("tr:first"),a.length)){for(var b=a.find("td").length,d="",e=0;e<b;e++)d+="<td></td>";a.after("<tr>"+d+"</tr>")}},addcol:function(a){if($(c.param[a.id].el).length){var b=$(c.param[a.id].el).index();$(c.param[a.id].cont).find("tr").each(function(){$(this).find("td:eq("+
b+")").after("<td></td>")})}},delrow:function(a){$(c.param[a.id].el).length&&$(c.param[a.id].el).parents("tr:first").remove()},delcol:function(a){if($(c.param[a.id].el).length){var b=$(c.param[a.id].el).index();$(c.param[a.id].cont).find("tr").each(function(){$(this).find("td:eq("+b+")").remove()})}},sel:function(a){c.addMinipan({id:a.id},[{tool:"table",action:"addrow",css:"tce_table-addrow"},{tool:"table",action:"addcol",css:"tce_table-addcol"},{tool:"table",action:"delrow",css:"tce_table-delrow"},
{tool:"table",action:"delcol",css:"tce_table-delcol"}])}},line:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_line_c"><span data-action="line" title="\u041b\u0438\u043d\u0438\u044f" class="tce_tools_btn tce_tools_line"></span></span>'},apply:function(a){c.restoreRange({id:a.id});document.execCommand("insertHorizontalRule")},sel:function(a){}},html:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_html_c"><span data-action="html" data-val="show" title="\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434" class="tce_tools_btn tce_html-i"></span></span>'},
apply:function(a){c.changeType({id:a.id})},sel:function(a){}},movie:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_movie_c"><span data-action="movie" title="\u041e\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0432\u043d\u0438\u0437" class="tce_tools_btn tce_movie-down"></span><span data-action="movie" title="\u041f\u043e\u0434\u043d\u044f\u0442\u044c \u0432\u0432\u0435\u0440\u0445" data-val="up" class="tce_tools_btn tce_movie-up"></span></span>'},apply:function(a){c.closePop({id:a.id});
if($(c.param[a.id].cont).length){if("table"==c.param[a.id].conttagname){var b=$(c.param[a.id].cont).parents(".sc_visual_table:first");b=b.length?b:$(c.param[a.id].cont)}else b=$(c.param[a.id].cont);a=a.val?a.val:"down";"up"==a?(a=b.prev(),a.length&&b.insertBefore(a)):"down"==a&&(a=b.next(),a.length&&b.insertAfter(a))}},sel:function(a){}},del:{button:function(a){return'<span class="tce_tools_btn_c tce_btn_del_c"><span data-action="del" title="\u0423\u0434\u0430\u043b\u0438\u0442\u044c" class="tce_tools_btn tce_del"></span></span>'},
apply:function(a){var b=c.param[a.id].el,d=c.param[a.id].tagname;"p"==d||"h1"==d||"h2"==d||"h3"==d||"h4"==d||"blockquote"==d||"hr"==d||"obj"==d||"stick"==d?$(b).remove():"li"==d?$(b).parent().remove():"td"==d||"th"==d?(b.parents(".sc_visual_table:first").remove(),b.parents("table:first").remove()):"b"==d||"strong"==d||"i"==d||"em"==d||"u"==d||"span"==d&&("line-through"==$(b).css("text-decoration")||"underline"==$(b).css("text-decoration"))?$(b).contents().unwrap():"img"==d&&b.parents(".sc_visual_table:first");
c.closePop({id:a.id});c.param[a.id]=void 0},sel:function(a){}},blank:{button:function(a){},apply:function(a){},sel:function(a){}}};this.changeType=function(a){if(a.id){var b=a.id;$("#sc_code_editor_"+b).length&&"block"==$("#sc_code_editor_"+b).css("display")?((a=$("#sc_code_editor_"+b).text())&&(a=c.clearCode(a)),$("#"+b+" .tce_content").html(a).show(),$("#sc_code_editor_"+b).hide(),$("#"+b+" .tce_tools_c").removeClass("sc_html_mode")):(c.closePop({id:a.id}),a=$("#"+b+" .tce_content").html(),a=c.formatCode(c.clearCode(a)),
$("#sc_code_editor_"+b).text(a).show().focus(),$("#"+b+" .tce_content").hide(),$("#"+b+" .tce_tools_c").addClass("sc_html_mode"))}};this.clearCode=function(a){a&&(a=a.replace(/<p><br><\/p>/gi,"").replace(/<p>\n<br><\/p>/gi,"").replace(/<p><\/p>/gi,""));return a};this.formatCode=function(a){a&&(a=a.replace(/<(p|h1|h2|h3|h4|br|ul|ol|table|tbody|blockquote|div|tr|td|li)(.*?)>/gi,"\n<$1$2>").replace(/<(tr|td|li)(.*?)>/gi,"\n\t<$1$2>").replace(/<\/(table|tbody|tr|div|ul|ol)>/gi,"</$1>\n"),a=a.replace(/(\n){1,}/g,
"\n").replace(/(\n\t){1,}/g,"\n\t").trim());return a};this.codeColor=function(a){return a=a.replace(/&lt;(h1|h2|h3|h4|h5|a|textarea|b|strong|i|em|div|span|p|img|ul|ol|li|b|i|blockquote|br)((?:\s{1}[a-zA-Z]+="[^"]*"{1}\s*)*)&gt;{1}/gi,'<i class="sc_tag">&lt;$1<i class="sc_tag_attr">$2</i>&gt;</i>').replace(/&lt;\/(h1|h2|h3|h4|h5|a|textarea|b|strong|i|em|div|span|p|img|ul|ol|li|b|i|blockquote)&gt;{1}/gi,'<i class="sc_tag">&lt;/$1&gt;</i>')};this.formatTag=function(a){window.document.execCommand(a,!1,
null);return!1};this.saveArea=function(a){if(a&&a.id){c.closePop({id:a.id});var b=!1;if($("#sc_code_editor_"+a.id).length&&"block"==$("#sc_code_editor_"+a.id).css("display")){b=!0;var d=$("#sc_code_editor_"+a.id)}else d=$("#"+a.id+" .tce_content");if(d.length&&(b=b?d.text():d.html(),$(c.textarea[a.id]).val(b),"function"==typeof a.callback&&a.callback({id:a.id,ta:c.textarea[a.id]}),a["return"]))return b}};this.addMinipan=function(a,b){$("#"+a.id+" .tce_content sub").remove();var d=$(c.param[a.id].el).position(),
e="";for(f in b)c.tools[b[f].tool][b[f].action]&&(e+="<span onClick=\"tsxEd.tools['"+b[f].tool+"']['"+b[f].action+"']({id:'"+a.id+'\',t:$(this)});" class="tce_tools_btn '+b[f].css+'"></span>');var f=d.top-25;f=1>f?1:f;$("#"+a.id+" .tce_content").append('<sub alt="'+a.id+'" contenteditable="false" style="top:'+f+"px; left:"+(d.left+5)+'px" id="sc_visual_minipan_'+a.id+'" class="sc_visual_minipan">'+e+"</sub>");$("#sc_visual_minipan_"+a.id).fadeIn(300)};this.addDpTool=function(a){if(a&&a.id&&a.tool){$("#"+
a.id+" .tce_dp_tools_c").remove();var b=c.tools[a.tool].dptool?c.tools[a.tool].dptool({val:a.val,id:a.id}):"",d="";a.width&&(d+="width:"+a.width+";");a.height&&(d+="height:"+a.height+";");a.pos&&a.pos.left&&(d+="left:"+a.pos.left+"px;");$("#"+a.id).append("<div onClick=\"tsxEd.closePop({t:this,id:'"+a.id+'\'})" class="tce_tools_popbg_c"></div><div style="'+d+'" class="tce_dp_tools_c">'+b+"</div>")}};this.addPop=function(a){if(a&&a.id){$("#"+a.id+" .tce_tools_pop_c, #"+a.id+" .tce_tools_popbg_c").remove();
var b="";a.width&&(b+="width:"+a.width+";");a.height&&(b+="height:"+a.height+";");var c=a&&a.title?'<div class="tce_tools_pop_t">'+a.title+"</div>":"",e=a&&a.content?'<div class="tce_tools_pop">'+a.content+"</div>":"",f="";if(a&&a.button){f+='<div class="tce_tools_pop_btn_c">';for(var g in a.button)if(a.button[g].title){var k=a.button[g].active?" active":"",h="";"close"==a.button[g].action?h="tsxEd.closePop({t:this,id:'"+a.id+"'});":a.button[g].action&&a.button[g].tools&&(h="tsxEd.tools['"+a.button[g].tools+
"'].apply({id:'"+a.id+"',action:'"+a.button[g].action+"'});");f+='<span onClick="'+h+'" class="tce_tools_pop_btn'+k+'">'+a.button[g].title+"</span>"}f+="</div>"}$("#"+a.id).append('<div class="tce_tools_popbg_c"></div><div style="'+b+'" class="tce_tools_pop_c"><span onClick="tsxEd.closePop({t:this,id:\''+a.id+'\'});" class="tce_tools_pop_close"></span>'+c+'<div class="tce_tools_pop">'+e+"</div>"+f+"</div>")}};this.closePop=function(a){$("#"+a.id+" .tce_tools_popbg_c, #"+a.id+" .tce_tools_pop_c, #"+
a.id+" .tce_dp_tools_c, #"+a.id+" .sc_visual_minipan").remove();$("#"+a.id+" .tce_tools_select_activate").removeClass("tce_tools_select_activate")};this.numberPlus=function(a){if(a&&a.t){c.restoreRange({id:a.id});var b=$(a.t).parent().find(".tce_tools_numric_tx"),d=b.attr("data-min")?parseInt(b.attr("data-min")):0,e=b.attr("data-max")?parseInt(b.attr("data-max")):0,f=b.text();f=f?parseInt(f):d;d=a.s?f-1>=d?f-1:f:f+1<=e?f+1:f;f!=d&&a.action&&c.tools[a.action].apply&&c.tools[a.action].apply({val:d,
id:a.id})&&b.text(d)}};this.editElm=function(a){if(a=c.detectEl({t:a.t})){$("#"+a+" .tce_content sub").remove();$("#"+a+" .tce_tools_btn.tce_tools_btn_active").removeClass("tce_tools_btn_active");if("h1"==c.param[a].conttagname||"h2"==c.param[a].conttagname||"h3"==c.param[a].conttagname||"h4"==c.param[a].conttagname||"p"==c.param[a].conttagname||"blockquote"==c.param[a].conttagname)c.tools.format.sel({tn:c.param[a].conttagname,id:a}),c.tools.font.sel({tn:c.param[a].conttagname,id:a}),c.tools.fontsize.sel({tn:c.param[a].conttagname,
etn:c.param[a].tagname,id:a}),c.tools.align.sel({tn:c.param[a].conttagname,id:a});"b"==c.param[a].tagname||"strong"==c.param[a].tagname||"i"==c.param[a].tagname||"em"==c.param[a].tagname||"u"==c.param[a].tagname||"s"==c.param[a].tagname||"strike"==c.param[a].tagname||"span"==c.param[a].tagname?c.tools.mark.sel({tn:c.param[a].tagname,id:a}):"a"==c.param[a].tagname?c.tools.paint.sel({tn:c.param[a].tagname,id:a}):"img"==c.param[a].tagname?c.tools.img.sel({tn:c.param[a].tagname,id:a}):("td"==c.param[a].tagname||
"th"==c.param[a].tagname)&&c.tools.table.sel({tn:c.param[a].tagname,id:a})}};this.detectEl=function(a){var b=!1;a&&a.t?b=$(a.t):a&&a.id&&(b=$(a.id));if(0!=b&&(a=b.parents(".tce_content_c").attr("id"))){var d=b.get(0).tagName.toLowerCase(),e=b,f=d;if("td"==d||"th"==d){var g=b.parents("table:first");g.length&&(e=g,f="table")}else if("p"!=d||"ul"!=d||"ol"!=d)g=b.parents("p:first"),g.length&&(e=g,f=g.get(0).tagName.toLowerCase());c.param[a]={};c.param[a].tagname=d;c.param[a].conttagname=f;c.param[a].cont=
e;c.param[a].el=b;return a}};this.showOption=function(a){a&&a.t&&($(a.t).addClass("tce_tools_select_activate"),$("#"+a.id).append("<div onClick=\"tsxEd.closePop({t:this,id:'"+a.id+'\'})" class="tce_tools_popbg_c"></div>'))};this.getOption=function(a){var b="";if(a&&a.options&&a.name){b+="<span onClick=\"tsxEd.showOption({t:this,id:'"+a.id+'\'});" class="tce_tools_select_c tce_tools_select_'+a.name+'"><span class="tce_tools_select">';for(var c in a.options)a.options[c].val&&(b+='<span onClick="tsxEd.getOptionVal(this);" data-id="'+
a.id+'" data-name="'+a.name+'" data-value="'+a.options[c].val+'" class="tce_tools_select_option'+(a.options[c].selected?" tce_tools_selected":"")+(a.options[c].css?" "+a.options[c].css:"")+'">'+a.options[c].name+"</span>");b+="</span></span>"}return b};this.getOptionVal=function(a){if(a&&$(a).parents(".tce_tools_select_activate").length){var b=$(a).attr("data-value");b=b?b:"";var d=$(a).attr("data-name"),e=$(a).attr("data-id");d&&c.tools[d].apply&&(c.tools[d].apply({val:b,t:a,id:e}),$(a).parent().find(".tce_tools_selected").removeClass("tce_tools_selected"),
$(a).addClass("tce_tools_selected"),setTimeout(function(){$(a).parents(".tce_tools_select_activate").removeClass("tce_tools_select_activate");c.closePop({id:e})},.1))}};this.keyUp=function(a){a.e&&8==a.e.keyCode&&(a=a.id,$("#"+a+" .tce_content p, #"+a+" .tce_content div, #"+a+" .tce_content h1, #"+a+" .tce_content h2, #"+a+" .tce_content h3, #"+a+" .tce_content h4, #"+a+" .tce_content blockquote, #"+a+" .tce_content ul, #"+a+" .tce_content ol").length||(document.execCommand("insertHTML",!1,'<p id="tce-replacer"></p>'),
c.detectEl({id:"#"+a+" #tce-replacer"}),$("#"+a+" #tce-replacer").removeAttr("id")))};this.pasteFormat=function(a){a.id&&$("#"+a.id+" .tce_content").msword_html_filter()};this.pasteCodeFormat=function(a){a.id&&setTimeout(function(){$("#sc_code_editor_"+a.id).text($("#sc_code_editor_"+a.id).text())},.001)};this.stripTags=function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return a.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,
function(a,c){return-1<b.indexOf("<"+c.toLowerCase()+">")?a:""})};this.uid=function(){return"_"+Math.random().toString(36).substr(2,9)};this.saveRange=function(a){if(a&&a.id){"undefined"==typeof c.param[a.id]&&(c.param[a.id]={});c.param[a.id].range=null;var b=window.getSelection();0<b.rangeCount&&(c.param[a.id].range=b.getRangeAt(0))}};this.restoreRange=function(a){a&&a.id&&"undefined"!=typeof c.param[a.id]&&(a=c.param[a.id].range)&&(window.getSelection?(s=window.getSelection(),0<s.rangeCount&&s.removeAllRanges(),
s.addRange(a)):document.selection&&a.select())};this.htmlspecialchars=function(a){"string"==typeof a&&(a=a.replace(/&/g,"&amp;"),a=a.replace(/"/g,"&quot;"),a=a.replace(/'/g,"&#039;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"));return a}}var tsxEd=new tsxEdClass;